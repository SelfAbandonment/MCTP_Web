# 项目背景与核心信息
我正在开发一个基于 Django 5.2.7 的 Minecraft 机械动力（Create Mod）服务器官方网站（项目名：MCTP），定位为「完整的服务器官网系统」，核心服务于 Minecraft 机械动力模组玩家，提供内容管理、玩家互动、资源分发等一站式功能。

# 技术栈详情
- 核心框架：Django 5.2.7
- 后台管理：SimpleUI（美化后台界面）
- 富文本编辑：CKEditor（支持新闻、百科、教程等内容编辑）
- 图片处理：Pillow（处理上传图片、缩略图生成）
- 数据库：默认 SQLite（可兼容 MySQL/PostgreSQL 替换）
- 静态文件：Django 内置静态文件管理（staticfiles）、用户上传文件存储（media 目录）
- 模板引擎：Django 内置模板系统（需支持响应式设计）

# 核心模块与功能清单
## 1. home（首页和基础页面）
- 数据模型：Page（静态页面：关于我们、服务器规则等）、ServerInfo（服务器配置：IP、端口、版本、QQ群/Discord链接等）、Carousel（首页轮播图）
- 核心功能：服务器信息展示、静态页面访问、轮播图轮播

## 2. news（新闻公告系统）
- 数据模型：Category（新闻分类）、Article（新闻文章：支持新闻、公告、活动、更新日志类型）
- 核心功能：文章置顶、浏览量统计、富文本编辑、分类筛选、分页展示

## 3. wiki（知识库/百科）
- 数据模型：WikiCategory（多级百科分类）、WikiArticle（百科文章：机械动力教程、新手指南）、Tutorial（教程系列）、TutorialStep（教程步骤）
- 核心功能：难度等级标注、标签系统、浏览统计、多级分类导航、教程分步展示

## 4. players（玩家管理系统）
- 数据模型：Player（玩家信息：游戏统计、在线状态）、WhitelistApplication（白名单申请）、PlayerAchievement（玩家成就）
- 核心功能：白名单在线申请、自动/批量审核、玩家成就展示、玩家数据关联

## 5. gallery（作品展示）
- 数据模型：GalleryCategory（作品分类）、Gallery（作品主体：建筑、机械装置等）、GalleryImage（作品多图上传）、Comment（作品评论）
- 核心功能：多图上传与轮播、评论互动、点赞功能、浏览统计、精选作品推荐

## 6. download（下载中心）
- 数据模型：DownloadCategory（下载分类）、Download（下载文件：整合包、模组、资源包等，支持本地文件/外链）、ModList（服务器模组列表）、UpdateLog（版本更新日志）
- 核心功能：下载统计、版本管理、分类筛选、模组信息展示

# 项目核心目标
1. 功能完整性：覆盖 Minecraft 服务器官网必备的内容管理、玩家互动、资源分发需求；
2. 易用性：后台管理简洁高效（SimpleUI 适配），前台页面响应式（适配 PC/移动端）；
3. 适配性：贴合机械动力模组玩家需求（教程、作品、模组下载等场景）；
4. 可扩展性：支持后续对接 Minecraft 服务器数据、第三方工具（Discord/QQ机器人）；
5. 安全性：保障文件上传、表单提交、数据存储的安全性。

# 可扩展需求方向（可选补充）
- 前端优化：精美的响应式模板、SEO 优化、交互体验提升（如作品轮播、评论实时刷新）；
- 功能扩展：MC 服务器状态查询（mcstatus）、玩家数据同步（服务器插件对接）、在线地图展示、论坛系统、积分商城、Discord/QQ 机器人集成；
- 性能优化：Redis 缓存、CDN 加速、数据库索引优化、静态文件压缩；
- 安全加固：HTTPS 配置、CSRF 防护、SQL 注入防护、文件上传校验、权限管控；
- 部署落地：生产环境部署（Nginx+Gunicorn/uWSGI）、数据库迁移（SQLite→MySQL）、日志管理。

# 具体需求
## 一、前端体验优化（像素级细化）
### 1. 首页响应式模板开发（home 模块）
#### 1.1 整体风格与布局
- 风格定义：工业风+科技感，主色调（#1E293B 深灰）、辅助色（#0EA5E9 机械蓝）、点缀色（#94A3B8 金属银），字体用 Inter（无衬线，清晰易读）；
- 布局结构：12列网格布局，PC端最小宽度1200px，移动端自适应（≤768px 单列布局），页面间距统一为 24px，卡片圆角 8px，阴影浅灰色（rgba(0,0,0,0.05)）。

#### 1.2 核心区域细节
- 【导航栏】
    - PC端：左侧 Logo（服务器名称+机械动力图标）、中间导航菜单（首页、新闻、Wiki教程、作品展示、下载中心、白名单申请）、右侧玩家入口（登录/注册按钮，已登录显示游戏昵称+头像）；
    - 移动端：Logo 居中，汉堡菜单（点击展开导航），无玩家入口（需跳转至个人中心页面）；
    - 交互：滚动时导航栏背景从透明变为深灰（#1E293B），菜单hover时底部出现蓝色下划线（高度2px，过渡0.3秒）。

- 【轮播图区域】
    - 尺寸：PC端高500px，移动端高300px，图片比例16:9，支持上传 JPG/PNG/WebP 格式（单张≤10MB）；
    - 交互：自动切换（间隔5秒），手动点击圆点切换，hover时暂停自动切换，点击轮播图跳转至对应链接（新闻/活动/下载页面，后台可配置）；
    - 样式：轮播图底部叠加渐变蒙版（从透明到深灰），显示标题（白色24px粗体）和简介（灰色16px），居左对齐，距离底部30px。

- 【服务器核心信息卡片】
    - 布局：PC端4列卡片（IP端口、版本、在线状态、社群链接），移动端2列换行；
    - 每卡细节：
        - IP端口卡：图标（服务器图标）+ 标题“服务器地址”+ 内容（IP：mc.mctp.com，端口：25565，可复制按钮，点击弹出“复制成功”提示）；
        - 版本卡：图标（版本图标）+ 标题“游戏版本”+ 内容（1.20.1 - Forge 47.1.0 / Create Mod 0.5.1.f）；
        - 在线状态卡：图标（在线/离线图标，在线绿色#22C55E，离线红色#EF4444）+ 标题“当前状态”+ 内容（在线人数/最大人数，如“8/20”，实时刷新）；
        - 社群链接卡：图标（QQ/Discord图标）+ 标题“加入我们”+ 内容（QQ群：123456789，Discord链接按钮，点击跳转外部页面）；
    - 交互：卡片hover时阴影加深（rgba(0,0,0,0.1)），轻微上浮（transform: translateY(-3px)，过渡0.3秒）。

- 【新闻/教程/作品精选区】
    - 每个区域统一结构：顶部标题（如“最新公告”）+ 更多按钮（跳转至对应列表页）+ 卡片列表；
    - 新闻精选：PC端3列卡片，移动端1列，每卡显示封面图（16:9，高150px）、分类标签（如“公告”，蓝色背景）、标题（18px，最多2行，溢出省略）、发布时间（灰色14px）、浏览量（灰色14px，带眼睛图标）；
    - 教程精选：PC端2列卡片，每卡显示难度标签（基础/进阶/高级，颜色分别为绿色/黄色/红色）、标题、作者、浏览量；
    - 作品精选：PC端4列卡片，每卡显示缩略图（正方形，高200px）、作品名称、作者、点赞数，hover时显示“查看详情”按钮。

- 【下载入口区域】
    - 布局：通栏深色背景（#1E293B），居中显示“快速下载”标题（28px白色）、“最新整合包”副标题（18px灰色）、下载按钮（蓝色#0EA5E9，padding 12px 32px，圆角4px，hover时加深色#0284C7）；
    - 交互：点击按钮跳转至下载中心的“整合包”分类页面，按钮添加轻微脉冲动画（0.5秒循环）。

- 【页脚】
    - 内容：服务器版权信息（© 2025 MCTP 机械动力服务器 - 仅供学习交流）、隐私政策/用户协议链接、管理员联系方式（QQ：123456）；
    - 样式：浅灰色背景（#F8FAFC），文字灰色（#64748B），14px，居中对齐。

#### 1.3 验收标准
- 适配设备：PC（1920px/1200px）、平板（768px）、手机（375px）无布局错乱；
- 交互效果：所有hover/点击反馈正常，轮播图切换流畅无卡顿；
- 加载性能：PC端首屏加载≤2秒，移动端≤3秒（无大文件未压缩）；
- 兼容性：支持 Chrome、Edge、Firefox 最新版，Safari 15+。

### 2. 核心页面模板完善（全模块）
#### 2.1 新闻列表页（news 模块）
- 布局：左侧分类筛选栏（固定宽度240px），右侧内容区（12列-2列=10列）；
- 分类筛选栏：显示所有新闻分类（公告、活动、更新日志），当前分类高亮（蓝色边框左对齐），支持点击切换；
- 内容区：
    - 置顶文章：通栏卡片，红色“置顶”标签，封面图（全宽，高200px），标题（24px粗体），发布时间+作者+浏览量，摘要（16px灰色）；
    - 普通文章：分页显示（每页10条），列表项包含小封面图（100x100px）、标题（18px）、分类标签、发布时间、浏览量，hover时背景色变浅灰（#F1F5F9）；
- 交互：支持按发布时间排序（默认最新在前），分页控件在底部（上一页/下一页+页码，当前页高亮）。

#### 2.2 新闻详情页（news 模块）
- 内容区：
    - 文章头部：标题（28px粗体，居中）、meta信息（分类标签+发布时间+作者+浏览量，居中，14px灰色）、封面图（全宽，高400px，响应式自适应）；
    - 文章内容：CKEditor 富文本渲染（字体16px，行高1.8，段落间距16px），图片自适应宽度（最大100%），代码块带高亮样式；
    - 底部：“返回列表”按钮（灰色，hover时蓝色），相关推荐文章（3篇，横向卡片）。

#### 2.3 Wiki/教程页（wiki 模块）
- 【Wiki列表页】
    - 左侧：多级分类导航（最多3级），父分类可折叠/展开（点击箭头切换），当前分类高亮（蓝色背景）；
    - 右侧：
        - 筛选栏：支持按标签筛选（如“基础机械”“自动化”“红石联动”），标签可多选（点击选中，蓝色背景）；
        - 内容区：分页显示Wiki文章卡片（每页12条），卡片包含标题、难度标签、作者、浏览量、更新时间；
- 【教程详情页】
    - 左侧：教程系列导航（同一Tutorial下的所有TutorialStep，按顺序排列，当前步骤高亮）；
    - 右侧：
        - 教程信息：标题（24px）、难度标签、作者、发布时间、总步骤数（如“共3步”）；
        - 步骤内容：按TutorialStep顺序展示，每步包含步骤序号（蓝色圆形，如“1”）、标题（18px）、图文内容（图片+文字说明）；
        - 导航按钮：“上一步/下一步”（底部固定，点击跳转对应步骤，第一步隐藏“上一步”，最后一步隐藏“下一步”）。

#### 2.4 作品展示页（gallery 模块）
- 【作品列表页】
    - 顶部：分类筛选（下拉菜单）+ 精选筛选（勾选“仅看精选”），排序方式（最新发布/最多点赞/最多评论）；
    - 内容区：PC端3列卡片，移动端1列，每卡包含：
        - 缩略图（正方形，高250px，覆盖裁剪）；
        - 作品信息：标题（18px）、作者（14px灰色）、分类标签、点赞数（带爱心图标）+ 评论数（带评论图标）；
        - 精选标识：右上角红色“精选”标签（仅精选作品显示）；
- 【作品详情页】
    - 左侧：多图轮播区（主图高500px，缩略图横向排列在底部，点击切换主图，支持鼠标滚轮放大预览）；
    - 右侧：
        - 作品信息：标题（24px）、作者头像+昵称（点击跳转作者主页）、发布时间、分类、标签（最多5个，可点击筛选同标签作品）；
        - 互动区：点赞按钮（红色爱心，点击变色，防重复点赞，显示当前点赞数）、收藏按钮（灰色星星，点击变黄）；
        - 描述区：CKEditor 富文本渲染（作品介绍，16px，行高1.6）；
    - 评论区：
        - 评论表单：仅已登录玩家可见，包含表情选择器（10个常用游戏表情）、文字输入框（最多500字）、提交按钮；
        - 评论列表：按时间倒序排列，每条评论包含用户头像+昵称、发布时间、评论内容、点赞按钮（灰色，点击变蓝）；
        - 交互：评论提交后实时刷新，无需刷新页面，支持删除自己的评论（作者/管理员可见删除按钮）。

#### 2.5 下载中心页（download 模块）
- 左侧：分类导航（整合包、模组、资源包、工具），当前分类高亮；
- 右侧：
    - 版本筛选：下拉菜单（如“1.20.1”“1.19.2”），默认显示“全部版本”；
    - 下载卡片：PC端2列，移动端1列，每卡包含：
        - 基本信息：标题（18px）、版本号（蓝色标签，如“V2.3”）、文件大小（14px灰色）、更新时间；
        - 功能信息：支持的加载器（Forge/Fabric，图标标识）、适配游戏版本；
        - 操作区：下载按钮（蓝色，点击统计下载量）、详情按钮（灰色，点击展开文件说明）；
        - 说明区（展开后）：文件描述、安装教程链接、更新日志摘要；
- 【模组列表页】
    - 表格布局：列名（模组名称、版本、功能简介、作者、状态（已安装/待更新））；
    - 交互：支持按模组名称搜索（顶部搜索框），点击模组名称跳转至详情页（显示完整功能、下载链接）。

#### 2.6 白名单申请页（players 模块）
- 表单布局：居中对齐，宽度PC端600px，移动端100%（左右留20px边距）；
- 表单字段（带实时验证）：
    - QQ号：输入框（仅允许数字，长度5-13位，实时提示“格式正确”/“格式错误”）；
    - 游戏昵称：输入框（长度3-16位，支持字母、数字、下划线，禁止特殊字符，提示“请输入游戏内准确昵称”）；
    - Mc皮肤预览：自动获取（输入昵称后，点击“获取皮肤”按钮，调用 Minecraft 皮肤API显示正面/背面预览图，尺寸100x100px）；
    - 申请理由：CKEditor 精简版（仅支持文字、换行，最多500字，提示“说明你对机械动力模组的了解和加入服务器的意愿”）；
    - 同意规则：勾选框（必须勾选，否则无法提交，链接至“服务器规则”页面）；
    - 验证码：图形验证码（点击刷新，输入正确后方可提交）；
- 提交按钮：蓝色（#0EA5E9），宽度100%，padding 12px，点击后显示“提交中...”，提交成功/失败弹出提示（成功：绿色，提示“申请已提交，等待审核”；失败：红色，提示具体原因，如“QQ号格式错误”）；
- 状态查询：表单下方提供“申请状态查询”入口，输入QQ号可查询审核结果（待审核/已通过/已驳回，驳回显示原因）。

#### 2.7 验收标准（核心页面）
- 富文本渲染：新闻、教程、作品描述中的图片、文字、代码块显示正常，无格式错乱；
- 交互逻辑：筛选、排序、分页、评论提交、点赞等功能正常，无报错；
- 响应式适配：所有页面在PC/平板/手机端布局合理，无元素溢出或遮挡；
- 表单验证：所有字段验证规则生效，错误提示清晰，提交按钮状态正确（未满足条件时禁用）。

### 3. SEO 与性能优化
#### 3.1 SEO 优化细节
- 元标签配置：
    - 首页：标题“MCTP 机械动力服务器 - 专注 Create Mod 玩法 | 整合包下载 | 教程攻略”，关键词“Minecraft 机械动力服务器、Create Mod、MC 整合包、机械动力教程、Minecraft 白名单服务器”，描述“MCTP 是基于 Minecraft 1.20.1 机械动力（Create Mod）的专属服务器，提供最新整合包下载、详细教程攻略、玩家作品展示和白名单申请服务，打造纯粹的机械自动化玩法社区”；
    - 新闻列表页：标题“【MCTP】新闻公告 - 服务器最新动态、活动通知”，关键词“MCTP 新闻、机械动力服务器公告、MC 活动通知”，描述“MCTP 机械动力服务器官方新闻公告，及时发布服务器更新、活动通知、维护公告等信息”；
    - 详情页（新闻/教程/作品）：标题“{文章标题} - MCTP 机械动力服务器”，关键词“{文章标签}、MCTP、机械动力教程/作品/新闻”，描述“{文章摘要，最多150字}”；
- 结构化数据：为新闻、教程、作品添加 Schema.org 结构化数据（Article 类型），包含标题、作者、发布时间、内容摘要，便于搜索引擎抓取；
- 内链优化：文章中关键词（如“自动化农场”“机械臂”）自动链接至对应 Wiki 页面（可在后台配置关键词-链接映射）。

#### 3.2 性能优化细节
- 图片优化：
    - 上传时自动生成缩略图（列表页用缩略图，详情页用原图），缩略图尺寸按页面需求固定（如新闻列表封面图 300x180px）；
    - 所有图片添加 loading="lazy" 延迟加载（首屏图片除外），格式优先使用 WebP（兼容低版本浏览器自动降级为 JPG/PNG）；
- 静态资源优化：
    - CSS/JS 文件压缩合并（使用 Django 静态文件处理或第三方工具），添加缓存头（Cache-Control: max-age=86400）；
    - 引入 CDN 加载第三方资源（如 jQuery、Font Awesome 图标库）；
- 页面加载体验：
    - 添加首屏加载动画（机械齿轮旋转效果，与机械动力主题契合），加载完成后淡出；
    - 列表页分页采用“滚动加载更多”（移动端）+“点击加载更多”（PC端），减少初始加载数据量。

#### 3.3 验收标准
- SEO 效果：百度搜索“MCTP 机械动力服务器”可在前3页找到官网，核心页面可被收录；
- 加载性能：PC端首屏加载≤2秒，移动端≤3秒（使用 Lighthouse 检测得分≥85分）；
- 图片加载：延迟加载生效，首屏仅加载可视区域图片，无冗余请求。

## 二、核心功能完善（逻辑级细化）
### 1. 白名单申请自动化审核（players 模块）
#### 1.1 数据模型扩展
- 在 WhitelistApplication 模型中新增字段：
    - qq_group_verified（BooleanField，默认False，记录是否通过QQ群验证）；
    - verification_time（DateTimeField，null=True，验证时间）；
    - review_log（TextField，null=True，审核日志，格式：“2025-10-01 12:00:00 - 系统自动审核：QQ群成员，通过 | 2025-10-01 12:05:00 - 管理员XXX：手动修改状态为通过”）；
    - reject_reason（CharField，max_length=200，null=True，驳回原因）。

#### 1.2 QQ群验证逻辑（对接 QQ 开放平台 API）
- 前置条件：服务器管理员已申请 QQ 开放平台开发者账号，创建应用并获取 AppID、AppSecret，已将机器人加入服务器 QQ 群；
- 验证流程：
    1. 玩家在白名单申请表单中输入 QQ 号，点击“验证QQ群成员”按钮；
    2. 前端调用后端接口，后端通过 QQ 开放平台 API（如“获取群成员列表”接口）查询该 QQ 号是否在指定群（群号在后台配置）中；
    3. 验证结果返回前端：
        - 已在群：显示“验证通过”（绿色），qq_group_verified 字段设为 True；
        - 未在群：显示“验证失败，请先加入QQ群（群号：123456789）”（红色），禁止提交表单；
- API 异常处理：若 API 调用失败（如网络问题、接口限流），显示“验证服务暂时不可用，请稍后重试”，允许玩家手动提交申请（后台标记为“待手动审核”）。

#### 1.3 自动审核逻辑
- 触发时机：玩家提交白名单申请后，后端自动执行审核；
- 审核规则：
    - 条件1：qq_group_verified = True → 自动通过审核；
    - 条件2：qq_group_verified = False 且 手动提交 → 标记为“待手动审核”；
    - 条件3：QQ号已存在未过期的申请（30天内）→ 自动驳回，提示“你已提交过申请，请勿重复提交”；
- 通过后操作：
    1. 自动创建 Player 模型记录：关联 QQ 号、游戏昵称，默认头像（Minecraft 皮肤头像），在线状态设为“离线”；
    2. 发送通知：通过 QQ 机器人向该玩家发送私信（“你的 MCTP 服务器白名单申请已通过！服务器 IP：mc.mctp.com，端口：25565，欢迎加入～”）；
    3. 更新审核日志：记录“系统自动审核：QQ群成员，通过”。

#### 1.4 后台批量审核功能（SimpleUI 适配）
- 后台列表页：
    - 筛选条件：按审核状态（待审核/已通过/已驳回）、提交时间、QQ号筛选；
    - 批量操作按钮：“批量通过”“批量驳回”“导出申请列表（Excel）”；
- 批量通过操作：
    1. 选中多个待审核申请，点击“批量通过”；
    2. 自动为每个申请创建 Player 模型，发送 QQ 通知，更新审核日志（“管理员XXX 批量通过审核”）；
- 批量驳回操作：
    1. 点击“批量驳回”后弹出输入框，要求输入驳回原因（如“未加入QQ群”）；
    2. 批量更新申请状态为“已驳回”，记录驳回原因和审核日志，发送 QQ 通知（“你的 MCTP 服务器白名单申请已驳回，原因：XXX，请修改后重新提交”）；
- 审核日志查看：在每个申请的详情页，显示完整审核日志（按时间倒序）。

#### 1.5 验收标准
- 自动审核：QQ群成员申请提交后≤1分钟自动通过，Player 模型创建成功，QQ 通知发送到位；
- 手动审核：后台可正常筛选、批量操作，审核日志记录完整，驳回原因清晰；
- 异常处理：API 调用失败时允许手动提交，无重复申请，表单验证规则生效。

### 2. 作品上传与管理优化（gallery 模块）
#### 2.1 数据模型扩展
- Gallery 模型新增字段：
    - is_featured（BooleanField，默认False，是否精选）；
    - tag（CharField，max_length=100，标签，用逗号分隔，如“自动化,农场,红石”）；
    - upload_time（DateTimeField，auto_now_add=True，上传时间）；
    - status（CharField，choices=[('pending', '待审核'), ('approved', '已通过'), ('rejected', '已驳回')]，默认'pending'，审核状态）；
    - reject_reason（CharField，max_length=200，null=True，驳回原因）；
- GalleryImage 模型新增字段：
    - sort_order（IntegerField，默认0，排序序号，越小越靠前）。

#### 2.2 玩家上传流程（前端+后端）
- 前置条件：玩家已通过白名单审核（Player 模型存在），且已登录；
- 上传表单（前端）：
    - 作品标题：输入框（3-30字，禁止特殊字符）；
    - 分类选择：下拉菜单（从 GalleryCategory 模型获取）；
    - 标签输入：输入框（最多5个标签，用逗号分隔，每个标签2-8字）；
    - 作品描述：CKEditor 精简版（最多1000字，支持图片、文字）；
    - 图片上传：
        - 支持拖拽上传/点击选择文件，最多8张，单张≤5MB，格式仅支持 JPG/PNG/WebP；
        - 上传后显示预览图（按上传顺序排列），每张图下方有“删除”“上移”“下移”按钮（调整 sort_order 字段）；
    - 提交按钮：需填写所有必填字段（标题、分类、至少1张图片）后启用，点击后显示“上传中...”，上传成功跳转至作品列表页，提示“作品已提交，等待审核”。

#### 2.3 后台审核与管理（SimpleUI）
- 作品列表页：
    - 筛选条件：按审核状态、分类、标签、上传时间、作者筛选；
    - 操作按钮：“审核通过”“驳回”“设为精选”“取消精选”“删除”，支持批量操作；
- 审核操作：
    - 审核通过：状态改为“approved”，作品在前台列表页显示；
    - 驳回：状态改为“rejected”，输入驳回原因（如“内容违规”“图片不清晰”），玩家可在个人中心查看驳回原因并重新编辑上传；
- 精选操作：
    - 设为精选：is_featured 设为 True，作品在首页“作品精选区”显示（最多显示8篇）；
    - 取消精选：is_featured 设为 False，从首页精选区移除；
- 权限控制：仅管理员可进行审核、精选操作，作者仅可编辑/删除自己的未审核/已驳回作品。

#### 2.4 玩家个人中心（作品管理）
- 个人中心“我的作品”页面：
    - 显示该玩家所有作品（按上传时间倒序），包含作品标题、审核状态（待审核/已通过/已驳回）、上传时间、操作按钮（编辑/删除）；
    - 已驳回作品：显示驳回原因（红色文字），提供“重新编辑”按钮；
    - 编辑功能：跳转至上传表单页面，预填充原有数据（标题、分类、标签、描述、已上传图片），支持修改所有字段和图片（添加/删除/重新排序）；
    - 删除功能：仅允许删除未审核/已驳回的作品，已通过审核的作品需联系管理员删除（显示“联系管理员”按钮，跳转至联系方式页面）。

#### 2.5 验收标准
- 上传功能：拖拽上传、图片排序、标签输入正常，文件格式/大小限制生效；
- 审核流程：后台审核操作正常，审核结果实时同步至前台，玩家可查看驳回原因；
- 精选功能：设为精选的作品在首页正确显示，数量不超过8篇；
- 权限控制：作者无法编辑/删除他人作品，管理员权限正常。

### 3. 下载中心版本管理与限制（download 模块）
#### 3.1 数据模型扩展
- Download 模型新增字段：
    - version（CharField，max_length=50，版本号，如“V2.3.1”）；
    - game_version（CharField，max_length=50，适配游戏版本，如“1.20.1”）；
    - loader（CharField，choices=[('forge', 'Forge'), ('fabric', 'Fabric'), ('both', '两者都支持')]，默认'forge'，加载器）；
    - file_size（CharField，max_length=20，文件大小，如“2.5GB”，自动计算）；
    - download_count（IntegerField，default=0，下载次数）；
    - is_latest（BooleanField，default=False，是否为最新版本）；
    - user_agreement（BooleanField，default=True，是否需要同意用户协议）；
    - file_type（CharField，choices=[('local', '本地文件'), ('external', '外部链接')]，默认'local'，文件类型）；
    - external_url（URLField，null=True，外部链接，file_type为'external'时必填）；
- ModList 模型新增字段：
    - mod_version（CharField，max_length=50，模组版本）；
    - mod_author（CharField，max_length=100，模组作者）；
    - mod_description（TextField，模组功能简介）；
    - mod_status（CharField，choices=[('installed', '已安装'), ('pending', '待更新'), ('removed', '已移除')]，默认'installed'，模组状态）；
    - sync_time（DateTimeField，auto_now=True，同步时间）。

#### 3.2 版本管理逻辑
- 最新版本标记：
    - 同一分类下（如“整合包”），当新增 Download 记录时，若勾选“设为最新版本”，则自动将该分类下其他记录的 is_latest 设为 False；
    - 前台下载列表页：默认显示最新版本（is_latest=True），提供“查看历史版本”链接，点击展开该分类下所有版本（按版本号降序排列）；
- 版本号规则：后台限制版本号格式为“V+数字.数字.数字”（如“V2.3.1”），或“正式版V+数字”（如“正式版V2”），不符合格式则无法提交。

#### 3.3 下载限制逻辑
- IP 限制：
    - 后端新增 DownloadLog 模型（记录下载IP、Download ID、下载时间）；
    - 下载时，查询该 IP 当天（00:00-24:00）的下载记录数，若≥5次，则禁止下载，提示“今日下载次数已达上限（5次/天），请明日再试”；
    - 管理员 IP 可豁免限制（后台配置白名单 IP 列表）；
- 用户协议勾选：
    - 若 Download 记录的 user_agreement=True，则下载前需勾选“我已阅读并同意《MCTP 服务器用户协议》”（链接至用户协议页面），未勾选则无法点击下载按钮；
- 下载统计：
    - 本地文件下载：玩家点击下载按钮后，后端记录下载日志，download_count 字段+1，然后返回文件下载链接；
    - 外部链接下载：玩家点击下载按钮后，记录下载日志，download_count 字段+1，然后跳转至 external_url；
    - 防刷量：同一 IP 同一文件，1小时内多次下载仅统计1次。

#### 3.4 模组列表同步功能
- 同步方式：后台提供“手动同步”按钮，点击后调用服务器插件接口（如 Spigot 插件的 HTTP 接口），获取服务器已安装模组列表；
- 同步逻辑：
    1. 接口返回数据格式（JSON）：[{"mod_name": "Create", "mod_version": "0.5.1.f", "mod_author": "SimonMcLoughlin", "mod_description": "机械动力核心模组", "mod_status": "installed"}, ...]；
    2. 后端接收数据后，按 mod_name 匹配 ModList 模型记录：
        - 已存在：更新 mod_version、mod_author、mod_description、mod_status、sync_time；
        - 不存在：新增 ModList 记录；
        - 服务器已移除但本地存在：将 mod_status 设为“removed”；
- 同步日志：后台记录同步时间、同步结果（成功/失败）、同步数量（新增/更新/移除），失败时显示错误信息（如“接口连接超时”）。

#### 3.5 验收标准
- 版本管理：最新版本标记正确，历史版本展示正常，版本号格式验证生效；
- 下载限制：单 IP 每日下载≤5次，用户协议勾选功能正常，防刷量统计准确；
- 模组同步：手动同步功能正常，模组信息更新准确，同步日志记录完整；
- 下载统计：download_count 字段统计准确，本地文件/外部链接下载流程正常。

### 4. 新闻/教程内容管理优化（news/wiki 模块）
#### 4.1 新闻发布优化（news 模块）
- Article 模型新增字段：
    - cover_image（ImageField，upload_to='news/cover/%Y/%m/%d'，新闻封面图）；
    - is_top（BooleanField，default=False，是否置顶）；
    - publish_time（DateTimeField，null=True，定时发布时间）；
    - view_count（IntegerField，default=0，浏览量，仅统计独立IP）；
    - view_log（TextField，null=True，浏览日志，格式：“2025-10-01 10:00:00 - 192.168.1.1 | 2025-10-01 10:05:00 - 10.0.0.1”）；
- 后台发布表单：
    - 封面图上传：支持 JPG/PNG/WebP，单张≤5MB，预览图尺寸200x120px；
    - 置顶设置：勾选“置顶”后，最多同时置顶3篇（超过则提示“最多置顶3篇新闻”）；
    - 定时发布：勾选“定时发布”后，选择发布时间（需晚于当前时间），到点后自动将状态改为“已发布”；
    - 分类选择：下拉菜单（从 Category 模型获取），支持单选；
- 浏览量统计逻辑：
    - 玩家访问新闻详情页时，获取其 IP 地址，查询 view_log 中是否包含该 IP（24小时内仅统计1次）；
    - 若不包含，则 view_count+1，将 IP 和访问时间添加到 view_log；
- 后台数据可视化：
    - 新闻列表页显示每篇文章的浏览量，支持按浏览量排序；
    - 单篇文章详情页显示近7天浏览趋势图（柱状图，SimpleUI 集成 ECharts）。

#### 4.2 教程关联优化（wiki 模块）
- 模型关联调整：
    - Tutorial 模型添加 foreignkey 关联 WikiCategory（教程分类）；
    - TutorialStep 模型添加 foreignkey 关联 Tutorial（所属教程），新增 step_number（IntegerField，步骤序号）；
- 后台教程创建流程：
    1. 创建 Tutorial 记录：填写教程名称、分类、难度等级、简介；
    2. 创建 TutorialStep 记录：选择所属 Tutorial，填写步骤序号（1、2、3...）、步骤标题、步骤内容（CKEditor 富文本）、步骤图片；
    3. 关联 WikiArticle：在 WikiArticle 模型中添加 foreignkey 关联 Tutorial（可选，用于将百科文章关联到教程系列）；
- 前台教程展示：
    - 教程列表页显示教程名称、分类、难度等级、步骤数（如“共3步”）、作者、浏览量；
    - 教程详情页左侧显示步骤导航（按 step_number 排序），当前步骤高亮，点击跳转；
    - 步骤内容中支持插入“上一步/下一步”按钮（固定在步骤内容底部），自动关联同一 Tutorial 下的前后步骤。

#### 4.3 验收标准
- 新闻发布：封面图上传、置顶、定时发布功能正常，浏览量统计准确（独立IP 24小时内仅计数1次）；
- 教程关联：步骤导航正常，上/下一步跳转正确，WikiArticle 可关联教程系列；
- 后台可视化：浏览趋势图显示正常，数据准确。

## 三、进阶功能扩展（技术对接细节）
### 1. MC 服务器状态实时查询（home 模块）
#### 1.1 技术选型与配置
- 依赖库：mcstatus（Python 库，用于查询 Minecraft 服务器状态），需添加到 requirements.txt；
- 后台配置：在 ServerInfo 模型中新增字段：
    - server_ip（CharField，max_length=50，服务器IP，默认空）；
    - server_port（IntegerField，默认25565，服务器端口）；
    - query_interval（IntegerField，默认30，查询间隔（秒），范围10-60）；
- 定时任务：使用 Django 定时任务插件（如 django-celery-beat），按 query_interval 配置的间隔，自动查询服务器状态并缓存。

#### 1.2 查询逻辑与缓存
- 查询流程：
    1. 定时任务调用 mcstatus.Server(server_ip, server_port).status() 获取服务器状态；
    2. 解析返回数据：在线状态（online）、当前在线人数（players.online）、最大人数（players.max）、延迟（latency，毫秒）；
    3. 将解析后的数据存入 Redis 缓存（键：mctp_server_status，过期时间=query_interval+5秒）；
- 异常处理：
    - 若查询失败（如服务器离线、网络问题），缓存数据设为：online=False，players.online=0，players.max=20，latency=0；
    - 后台记录查询日志（成功/失败、时间、错误信息）。

#### 1.3 前台展示
- 服务器信息卡片：
    - 在线状态：显示“在线”（绿色）或“离线/维护中”（红色）；
    - 在线人数：显示“当前 X 人 / 最大 Y 人”（X=players.online，Y=players.max）；
    - 延迟：显示“延迟：X ms”（X=latency，保留整数）；
- 交互：每 query_interval 秒自动刷新状态（前端 AJAX 请求后台接口，获取缓存数据，无页面刷新）；
- 离线提示：若服务器离线，显示“服务器维护中，预计维护时间：XXXX-XX-XX XX:XX”（维护时间可在后台 ServerInfo 模型配置）。

#### 1.4 验收标准
- 实时性：状态刷新间隔与配置一致，误差≤5秒；
- 准确性：在线状态、人数、延迟与服务器实际一致，误差≤50ms；
- 异常处理：服务器离线时提示正常，查询失败不影响页面加载。

### 2. 玩家数据同步与成就系统（players 模块）
#### 2.1 技术对接（服务器插件）
- 插件要求：服务器安装支持 HTTP 接口的插件（如 CustomAPI 插件），可获取玩家游戏数据并提供接口；
- 数据同步字段（Player 模型扩展）：
    - play_time（IntegerField，default=0，游戏时长（分钟））；
    - kill_count（IntegerField，default=0，击杀数）；
    - block_place_count（IntegerField，default=0，建造方块数）；
    - machine_unlock_count（IntegerField，default=0，解锁机械数）；
    - last_login_time（DateTimeField，null=True，最后登录时间）；
- 同步逻辑：
    - 后台提供“手动同步”按钮，或设置每日定时同步（如凌晨2点）；
    - 同步时，后端调用服务器插件接口（如 http://server-ip:port/api/players），获取所有玩家数据（JSON 格式）；
    - 按游戏昵称匹配 Player 模型（需玩家白名单申请时的游戏昵称与服务器一致）：
        - 已存在：更新 play_time、kill_count、block_place_count、machine_unlock_count、last_login_time；
        - 不存在：不处理（需玩家先申请白名单）；
    - 同步日志：记录同步时间、同步数量、失败玩家列表（昵称、原因）。

#### 2.2 成就系统设计
- 成就模型（PlayerAchievement 扩展）：
    - achievement_name（CharField，max_length=50，成就名称，如“入门机械师”）；
    - achievement_desc（CharField，max_length=200，成就描述，如“解锁3个基础机械”）；
    - achievement_condition（TextField，成就条件，如“machine_unlock_count >=3”）；
    - achievement_icon（ImageField，upload_to='achievements/icons/'，成就图标）；
    - achievement_level（CharField，choices=[('easy', '简单'), ('medium', '中等'), ('hard', '困难')]，默认'easy'，成就难度）；
- 玩家成就关联模型（PlayerAchievementRelation）：
    - player（ForeignKey，关联 Player 模型）；
    - achievement（ForeignKey，关联 PlayerAchievement 模型）；
    - unlock_time（DateTimeField，auto_now_add=True，解锁时间）；
- 自动解锁逻辑：
    - 玩家数据同步后，遍历所有成就，检查玩家数据是否满足成就条件（如 machine_unlock_count >=3）；
    - 若满足且未解锁，则创建 PlayerAchievementRelation 记录（解锁成就），并通过 QQ 机器人发送通知（“恭喜你解锁成就【入门机械师】！”）；

#### 2.3 前台展示
- 玩家个人中心：
    - 游戏数据卡片：显示游戏时长（转换为“X小时Y分钟”）、击杀数、建造方块数、解锁机械数、最后登录时间；
    - 成就列表：按解锁时间倒序排列，显示成就图标、名称、描述、解锁时间，未解锁成就显示灰色图标和“未解锁”标识；
- 排行榜关联：在排行榜中新增“成就解锁数”维度，支持按成就数排序。

#### 2.4 验收标准
- 数据同步：玩家数据同步准确，误差≤1%，同步日志完整；
- 成就解锁：满足条件后自动解锁，通知发送到位，个人中心展示正常；
- 兼容性：与服务器插件接口对接稳定，无数据丢失。

### 3. Discord/QQ 机器人集成（news/home 模块）
#### 3.1 技术选型
- QQ机器人：使用 astrbot框架（基于 OneBot 协议），对接 Python 后端；
- Discord机器人：使用 discord.py 库，创建 Discord 应用并获取 Token；
- 后台配置模型（新增 BotConfig 模型）：
    - qq_bot_enable（BooleanField，default=False，是否启用QQ机器人）；
    - qq_group_id（CharField，max_length=20，QQ推送群号）；
    - discord_bot_enable（BooleanField，default=False，是否启用Discord机器人）；
    - discord_token（CharField，max_length=100，Discord机器人Token）；
    - discord_channel_id（CharField，max_length=20，Discord推送频道ID）；
    - push_content_type（CharField，choices=[('news', '仅新闻'), ('announcement', '仅公告'), ('all', '全部')]，默认'all'，推送内容类型）。

#### 3.2 推送逻辑
- 触发时机：当后台发布新闻/公告（Article 模型状态改为“已发布”），且符合 push_content_type 配置时，自动触发推送；
- 推送内容格式：
    - 标题：【MCTP 服务器】{文章分类} - {文章标题}；
    - 内容：{文章摘要，最多100字} \n 查看详情：{文章官网链接}；
    - 附件：若有封面图，同步推送封面图；
- QQ机器人推送：通过 go-cqhttp 的 HTTP 接口发送群消息（支持文字+图片）；
- Discord机器人推送：通过 discord.py 库发送频道消息（支持文字+图片链接）；
- 推送日志：新增 PushLog 模型，记录推送时间、内容类型、推送平台（QQ/Discord）、推送结果（成功/失败）、错误信息。

#### 3.3 后台控制
- BotConfig 管理页面：支持开启/关闭机器人、配置群号/频道ID、选择推送内容类型；
- 手动推送：新闻详情页提供“手动推送”按钮，支持重新推送该文章至指定平台；
- 推送开关：可单独开启/关闭 QQ/Discord 推送，互不影响。

#### 3.4 验收标准
- 自动推送：新闻/公告发布后≤5分钟推送到位，内容格式正确，封面图同步正常；
- 后台控制：配置修改生效，手动推送功能正常；
- 日志记录：推送日志完整，失败时显示明确错误信息（如“QQ群号错误”“Discord Token 失效”）。

## 四、安全加固（细节级防护）
### 1. 表单与文件上传安全
#### 1.1 表单安全
- CSRF 防护：所有表单（白名单申请、评论、作品上传）启用 Django 内置 CSRF 防护（模板中添加 {% csrf_token %}）；
- 验证码：使用 django-simple-captcha 库，配置如下：
    - 验证码类型：图形验证码（字符+数字，4位）；
    - 刷新功能：支持点击验证码刷新；
    - 有效期：5分钟，过期后需重新获取；
    - 应用场景：白名单申请、评论提交、作品上传表单；
- 表单限流：使用 Django 中间件，限制同一 IP 单位时间内提交次数：
    - 白名单申请：1小时内最多3次；
    - 评论提交：1分钟内最多2次；
    - 限流提示：超过次数后显示“操作过于频繁，请稍后再试”，并记录IP和操作日志。

#### 1.2 文件上传安全
- 格式校验：
    - 前端：仅允许选择指定格式（图片：JPG/PNG/WebP，下载文件：ZIP/RAR/EXE/JAR）；
    - 后端：通过文件头校验（而非后缀名），如 JPG 文件头为 0xFFD8FF，PNG 为 0x89504E47；
- 大小限制：
    - 图片文件：单张≤5MB；
    - 下载文件：本地文件≤10GB；
- 恶意文件检测：使用 python-magic 库检测文件类型，过滤脚本文件（.py/.sh/.bat）、可执行文件（.exe 除外的高危格式）；
- 文件名处理：上传文件自动重命名（格式：{随机字符串}_{原文件名}），避免路径遍历攻击；
- 存储安全：用户上传文件存储在非 Web 根目录，通过 Django 视图函数控制访问权限（如仅登录用户可下载）。

#### 1.3 评论内容过滤
- 敏感词库：后台新增 SensitiveWord 模型，支持添加/删除/修改敏感词（如辱骂、违规词汇）；
- 过滤逻辑：
    - 评论提交时，后端遍历敏感词库，替换敏感词为“*”（如“垃圾”→“**”）；
    - 支持模糊匹配（如“垃 圾”也会被过滤）；
- 垃圾评论拦截：
    - 检测评论内容是否包含大量重复字符（如“aaaaa”）或无意义字符，是则拦截并提示“评论内容无效”；
    - 同一 IP 1小时内最多提交10条评论，超过则拦截。

#### 1.4 验收标准
- 表单安全：CSRF 防护生效，验证码正常，限流规则生效，无恶意提交；
- 文件上传：违规格式/大小文件无法上传，文件头校验生效，无恶意文件上传成功；
- 评论过滤：敏感词替换正常，垃圾评论被拦截，无违规内容显示。

### 2. 权限管控优化
#### 2.1 角色与权限定义
- 角色划分：
    - 普通玩家（Player）：已通过白名单审核的用户；
        - 权限：查看所有公开内容、提交白名单申请（已通过则不可重复提交）、上传作品、评论、点赞、下载文件、查看个人中心；
        - 限制：不可编辑/删除他人内容，不可审核内容；
    - 管理员（Admin）：Django 超级用户；
        - 权限：所有后台操作（内容审核、用户管理、配置修改、日志查看）、前台所有功能；
    - 作者（Author）：普通玩家的子角色（可选，后台配置）；
        - 权限：除管理员权限外，可编辑/删除自己发布的内容（已通过审核的作品需管理员批准）；
- 权限控制实现：
    - 前台：通过 Django 登录装饰器（@login_required）控制登录后访问，通过模板判断角色显示/隐藏操作按钮；
    - 后台：通过 SimpleUI 权限控制，普通玩家无后台访问权限，管理员拥有全部权限。

#### 2.2 操作日志记录
- 后台操作日志：使用 django-admin-log 库，记录所有后台操作：
    - 记录内容：操作人、操作时间、操作类型（新增/修改/删除）、操作对象（如“新闻：XXX”）、操作IP；
- 前台关键操作日志：记录玩家上传作品、提交评论、申请白名单等操作：
    - 记录内容：用户名、操作时间、操作类型、操作结果、IP地址；
- 日志管理：
    - 后台日志列表页：支持按操作人、时间、操作类型筛选，支持导出日志（Excel）；
    - 日志保留期：默认保留90天，超过自动删除（可在后台配置）。

#### 2.3 验收标准
- 权限边界：普通玩家无法越权操作（如编辑他人作品、访问后台），管理员权限正常；
- 日志记录：所有关键操作均有日志，记录信息完整，可追溯；
- 安全性：无权限提升漏洞，操作日志不可篡改。

## 五、部署落地（生产环境级细节）
### 1. 生产环境部署配置
#### 1.1 环境准备
- 服务器要求：Linux（Ubuntu 22.04 LTS 64位），CPU≥2核，内存≥4GB，硬盘≥50GB（存储上传文件）；
- 依赖安装：
    - 系统依赖：nginx、mysql-server、python3.10、python3-pip、redis-server、supervisor；
    - Python 依赖：在 requirements.txt 中添加 gunicorn、django-redis、mysqlclient、celery（定时任务）。

#### 1.2 数据库迁移（SQLite → MySQL）
- MySQL 配置：
    1. 登录 MySQL：mysql -u root -p；
    2. 创建数据库：CREATE DATABASE mctp_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci；
    3. 创建用户并授权：CREATE USER 'mctp_user'@'localhost' IDENTIFIED BY 'StrongPassword123!'; GRANT ALL PRIVILEGES ON mctp_db.* TO 'mctp_user'@'localhost'; FLUSH PRIVILEGES；
- Django 配置修改（settings.py）：
  ```python
  DATABASES = {
      'default': {
          'ENGINE': 'django.db.backends.mysql',
          'NAME': 'mctp_db',
          'USER': 'mctp_user',
          'PASSWORD': 'StrongPassword123!',
          'HOST': 'localhost',
          'PORT': '3306',
          'OPTIONS': {'charset': 'utf8mb4'},
      }
  }